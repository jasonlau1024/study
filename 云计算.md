# Aliyun

## 云产品

### OSS

#### 概述

#### oss RAM 访问控制

> 参考：https://help.aliyun.com/document_detail/61950.html?spm=a2c4g.11174283.6.1343.5a3a7da2p8UOgv

1. 云账号登录RAM控制台：https://ram.console.aliyun.com/overview 

2. 创建用户：

   人员管理--> 用户 --> 新建用户 --> 登录名&编程访问 --> 确定

3. 创建RAM自定义权限策略：

   RAM控制台--》权限管理--》权限策略管理--》新建权限策略

   oss授权参考：https://help.aliyun.com/knowledge_detail/58905.html

   ```shell
   ## 策略名称：AliyunOSSfbankFullAccess
   {
       "Version": "1",
       "Statement": [
           {
               "Effect": "Allow",
               "Action": "oss:*",
               "Resource": [
                   "acs:oss:*:*:fbank",
                   "acs:oss:*:*:fbank/*"
               ]
           }
       ]
   }
   ```

4. RAM用户添加权限

#### oss 跨域问题

![1575432276187](C:\Users\jason\AppData\Roaming\Typora\typora-user-images\1575432276187.png)



### WAF













## 维护笔记

### 实例自动恢复事件

参考文档：https://www.alibabacloud.com/help/zh/doc-detail/57052.htm

现象：ECS 实例被自动重启。

在托管ECS实例的底层硬件意外崩溃的情况下，如果确认故障不可逆转并且实例无法修复，则系统将自动重新启动实例，实现宕机迁移。在这种情况下，所恢复实例的所有实例元数据都将保持不变，例如实例ID以及私有和公网IP地址等。

自动恢复是异常类系统事件，其事件代码为SystemFailure.Reboot。





# Aws

## 相关概念

#### 基础概念

#### 可用区&区域

区域（Region）和可用区（Availability Zone，AZ）

1. 区域

   用户就近访问，降低网络延迟。通常是一个城市的若干个AZ组成一个region。

   AWS云服务在全球不同的地方都有数据中心。AWS 云在全球21 个地理区域内运营着66 个可用区。每个数据中心、可用区和AWS 区域都通过专门打造的、可用性高和低延迟的私有全球网络基础设施进行互连。该网络建立在全球性的、完全冗余、且并行的100 GbE 城域光纤网络上，通过横跨大西洋、太平洋和印度洋，以及地中海、红海和南中国海的跨洋电缆连接。

   图例：**AWS 全球Regions 采用100Gbe环网互联(除中国Region外)**

   ![img](https://img-blog.csdnimg.cn/20190609154527676.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0NvbnJhZF9XYW5n,size_16,color_FFFFFF,t_70)

2. 可用区

   一个region 内至少两个(通常三个)可用区，增强服务可用性、容错能力以及扩展性。每个可用区可以是多个（通常为3个）数据中心。

   可用区与可用区之间的距离都在100公里以内。采用高带宽、低延迟网络与完全冗余的专用城域光纤互连，为可用区之间提供高吞吐量和低延迟的网络。网络性能足以完成可用区之间的同步复制。







## 基础使用

### EC2

#### 系统初始化

```shell
## 关闭 selinux
getenforce
sed -i 's#SELINUX=enforcing#SELINUX=disabled#g' /etc/selinux/config
setenforce 0
## 修改当前时区
$ date -R
Wed, 18 Dec 2019 07:23:05 +0000
ln -sf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime
## 优化打开文件限制
echo '* soft nofile 655350' >>/etc/security/limits.conf
echo '* hard nofile 655350' >>/etc/security/limits.conf
echo '* hard nproc 655350' >>/etc/security/limits.conf
echo '* soft nproc 655350' >>/etc/security/limits.conf
```



#### 挂载磁盘

```shell
## 查看磁盘信息
fdisk -l
## 要添加的磁盘格式化
mkfs.xfs /dev/nvme1n1
## 挂载
mkdir /data
mount /dev/nvme1n1 /data
## 查看文件系统信息
df -h
## 重启自动挂载
## 查看磁盘 UUID
blkid
## 修改 /etc/fstab 添加新的磁盘挂载
UUID=f41e390f-835b-4223-a9bb-9b45984ddf8d /                       xfs     defaults        0 0
UUID=dc5ab6aa-4b03-42d7-816d-b1cdd09b2cbc /data                       xfs     defaults        0 0
```







## 常见问题

### 基础问题

#### EC2 重启 IP 是否会变

- 内网IP：不会

  在VPC内启动实例通过dhcp获取的是内网IP，只要您不对实例进行终止操作并对网卡进行删除操作，该实例的内网IP都不会改变。无论是您stop还是reboot。当您终止实例时，该内网IP就会被释放。 

  每台EC2上都有一个`dhcp client`的进程，默认情况下，该进程会每隔120s查询一次dhcp，您可以在linux系统实例的`/var/log/message`下看到dhclient 的活动信息。

- 公网IP：可能会

  如果是对外提供服务的EC2，需要绑定弹性IP，即EIP，避免因实例重启公网IP改变造成服务不可用。

#### 修改 Linux 网卡名为 eth0

参考：https://www.jianshu.com/p/b66981dbb389

参考：<https://aws.amazon.com/cn/premiumsupport/knowledge-center/install-ena-driver-rhel-ec2/>

```shell
## 查看服务器版本
$ cat /etc/redhat-release
CentOS Linux release 7.6.1810 (Core)
## 查看网卡名称
$ cat /etc/redhat-release
CentOS Linux release 7.6.1810 (Core)
## 更改网卡配置
cd /etc/sysconfig/network-scripts/
cp ifcfg-ens5 bak-ifcfg-ens5
cp ifcfg-eth0 bak-ifcfg-eth0
mv ifcfg-ens5 ifcfg-eth0
## 修改 "NAME" 和 "DEVICE" 信息


编辑grub文件


生成新的grub文件
grub2-mkconfig -o /boot/grub2/grub.cfg
```

